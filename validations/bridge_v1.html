<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Validation report: bridge_v1 &#8212; Chempleter 0.1.0b7 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=9550617d" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <script src="../_static/documentation_options.js?v=8b1483a0"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <link rel="icon" href="../_static/chempleter.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Validation report: extend_v2" href="extend_v2.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="validation-report-bridge-v1">
<h1>Validation report: bridge_v1<a class="headerlink" href="#validation-report-bridge-v1" title="Link to this heading">¶</a></h1>
<p>Model: bridge_v1</p>
<p>Samples Generated: 500</p>
<p>Generated On: 2026-01-04 20:40</p>
<section id="generation-quality-metrics">
<h2>Generation Quality Metrics<a class="headerlink" href="#generation-quality-metrics" title="Link to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Uniqueness</p></th>
<th class="head"><p>Novelty</p></th>
<th class="head"><p>SELFIES fidelity</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0.8900</p></td>
<td><p>1.0000</p></td>
<td><p>0.0083</p></td>
</tr>
</tbody>
</table>
</section>
<section id="descriptor-statistics">
<h2>Descriptor Statistics<a class="headerlink" href="#descriptor-statistics" title="Link to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Descriptor</p></th>
<th class="head"><p>Average</p></th>
<th class="head"><p>Minimum</p></th>
<th class="head"><p>Maximum</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>MW</p></td>
<td><p>235.1938</p></td>
<td><p>133.1500</p></td>
<td><p>303.4500</p></td>
</tr>
<tr class="row-odd"><td><p>LogP</p></td>
<td><p>3.0860</p></td>
<td><p>0.4700</p></td>
<td><p>6.1200</p></td>
</tr>
<tr class="row-even"><td><p>SA_Score</p></td>
<td><p>2.2645</p></td>
<td><p>1.0600</p></td>
<td><p>5.8900</p></td>
</tr>
<tr class="row-odd"><td><p>QED</p></td>
<td><p>0.7688</p></td>
<td><p>0.3260</p></td>
<td><p>0.9020</p></td>
</tr>
<tr class="row-even"><td><p>Fsp3</p></td>
<td><p>0.1675</p></td>
<td><p>0.0000</p></td>
<td><p>0.3800</p></td>
</tr>
<tr class="row-odd"><td><p>RotatableBonds</p></td>
<td><p>3.9620</p></td>
<td><p>0.0000</p></td>
<td><p>9.0000</p></td>
</tr>
<tr class="row-even"><td><p>RingCount</p></td>
<td><p>2.3200</p></td>
<td><p>1.0000</p></td>
<td><p>4.0000</p></td>
</tr>
<tr class="row-odd"><td><p>TPSA</p></td>
<td><p>24.6952</p></td>
<td><p>0.0000</p></td>
<td><p>63.6900</p></td>
</tr>
<tr class="row-even"><td><p>RadicalElectrons</p></td>
<td><p>0.0240</p></td>
<td><p>0.0000</p></td>
<td><p>1.0000</p></td>
</tr>
</tbody>
</table>
</section>
<section id="descriptor-distributions">
<h2>Descriptor Distributions<a class="headerlink" href="#descriptor-distributions" title="Link to this heading">¶</a></h2>
<img alt="Descriptor Distributions" class="align-center" src="../_images/bridge_v1.png" />
</section>
<section id="development-notes">
<h2>Development Notes<a class="headerlink" href="#development-notes" title="Link to this heading">¶</a></h2>
<p>The model was trained on SELFIES sequences derived from SMILES strings, with data sourced from the QM9 and ZINC datasets.
In contrast to the earlier setup in extend models, two additional control tokens—[MASK] and [BRIDGE] were introduced to explicitly model fragment bridging.
As before in extend models, SMILES randomization was applied at data loading time using non-canonical RDKit SMILES to increase sequence diversity.
Training was stopped once the loss reached a clear plateau, even after lowering the learning rate to 1e-5.</p>
<section id="bridging">
<h3>Bridging<a class="headerlink" href="#bridging" title="Link to this heading">¶</a></h3>
<p>Unlike the extend models, which learned to extend SMILES directly, this approach reformulates the task as a bridge completion problem.
During dataset construction, sufficiently long SELFIES sequences are split into three parts:</p>
<blockquote>
<div><ul class="simple">
<li><p>an initial fragment (frag1),</p></li>
<li><p>a contiguous segment treated as the bridge,</p></li>
<li><p>and an end fragment (frag2).</p></li>
</ul>
</div></blockquote>
<p>and the model is trained to predict the bridge tokens after [BRIDGE], followed by [END]. At inference time, two fragments are joined together as <code class="docutils literal notranslate"><span class="pre">frag1</span> <span class="pre">+</span> <span class="pre">[MASK]</span> <span class="pre">+</span> <span class="pre">frag2</span> <span class="pre">+</span> <span class="pre">[BRIDGE]</span></code> to form the prompt.</p>
</section>
<section id="loss-masking">
<h3>Loss Masking<a class="headerlink" href="#loss-masking" title="Link to this heading">¶</a></h3>
<p>The training loss is computed only on the predicted bridge tokens.
All target positions corresponding to [START], frag1, [MASK], frag2, and [BRIDGE] are ignored by the cross-entropy loss (set to zero as this alos the padding index).</p>
</section>
<section id="fragmentation-constraints">
<h3>Fragmentation constraints<a class="headerlink" href="#fragmentation-constraints" title="Link to this heading">¶</a></h3>
<p>Fragmentation is attempted only for molecules with sufficient length. For SELFIES sequences longer than 10 symbols:</p>
<ul class="simple">
<li><p>frag1 length is sampled randomly,</p></li>
<li><p>bridge length is sampled between 1 and 10 tokens,</p></li>
<li><p>frag2 contains the remainder.</p></li>
</ul>
<p>Shorter sequences are left unfragmented and passed through unchanged, so in principle, this model can also extend by leaving frag2 empty.</p>
<p>PyTorch dataset was defined as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ChempleterRandomisedBridgeDataset</span><span class="p">(</span><span class="n">Dataset</span><span class="p">):</span>
<span class="w">   </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   PyTorch Dataset for SELFIES molecular representations.</span>

<span class="sd">   :param smiles_file: Path to CSV file containing SMILES strings in a &quot;smiles&quot; column.</span>
<span class="sd">   :type smiles_file: str</span>
<span class="sd">   :param stoi_file: Path to JSON file mapping SELFIES symbols to integer tokens.</span>
<span class="sd">   :type stoi_file: str</span>
<span class="sd">   :returns: Integer tensor representation of tokenized molecule with dtype=torch.long.</span>
<span class="sd">   :rtype: torch.Tensor</span>
<span class="sd">   &quot;&quot;&quot;</span>

   <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">smiles_file</span><span class="p">,</span> <span class="n">stoi_file</span><span class="p">):</span>
      <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
      <span class="n">smiles_dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">smiles_file</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">smiles_dataframe</span><span class="p">[</span><span class="s2">&quot;smiles&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
      <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">stoi_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selfies_to_integer</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

   <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

   <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
      <span class="n">molecule_in_smiles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

      <span class="c1"># try randomisation</span>
      <span class="n">molecule</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="n">molecule_in_smiles</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">molecule</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
               <span class="n">molecule_in_selfies</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">encoder</span><span class="p">(</span>
                  <span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">canonical</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">doRandom</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
               <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
               <span class="n">molecule_in_selfies</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">encoder</span><span class="p">(</span><span class="n">molecule_in_smiles</span><span class="p">)</span>
               <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELFIES encoding error for randomised SMILES: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
            <span class="n">molecule_in_selfies</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">encoder</span><span class="p">(</span><span class="n">molecule_in_smiles</span><span class="p">)</span>

      <span class="n">symbols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sf</span><span class="o">.</span><span class="n">split_selfies</span><span class="p">(</span><span class="n">molecule_in_selfies</span><span class="p">))</span>

      <span class="c1"># try fragmentation</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">len_frag1</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span> <span class="o">-</span> <span class="mi">8</span><span class="p">)</span>
            <span class="n">len_bridge</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span>
               <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span>
            <span class="p">)</span>  <span class="c1"># bridge len ranges from 1 to 10.# this would be constraint later</span>
            <span class="n">len_frag2</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">len_frag1</span> <span class="o">+</span> <span class="n">len_bridge</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">frag1</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">[:</span><span class="n">len_frag1</span><span class="p">]</span>
            <span class="n">bridge</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">[</span><span class="n">len_frag1</span><span class="p">:</span><span class="n">len_frag2</span><span class="p">]</span>
            <span class="n">frag2</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">[</span><span class="n">len_frag2</span><span class="p">:]</span>

      <span class="k">else</span><span class="p">:</span>
            <span class="n">frag1</span> <span class="o">=</span> <span class="n">symbols</span>
            <span class="n">bridge</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">frag2</span> <span class="o">=</span> <span class="p">[]</span>

      <span class="n">symbols_molecule</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;[START]&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">frag1</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;[MASK]&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">frag2</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;[BRIDGE]&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">bridge</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;[END]&quot;</span><span class="p">]</span>
      <span class="p">)</span>
      <span class="n">integer_molecule</span> <span class="o">=</span> <span class="p">[]</span>

      <span class="c1"># check if all symbols exist in stoi</span>
      <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">symbols_molecule</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">symbol</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selfies_to_integer</span><span class="p">:</span>
               <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                  <span class="sa">f</span><span class="s2">&quot;Molecule symbol not found in stoi. Add </span><span class="si">{</span><span class="n">symbol</span><span class="si">}</span><span class="s2"> in stoi with correct integer mapping.&quot;</span>
               <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
               <span class="n">integer_molecule</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selfies_to_integer</span><span class="p">[</span><span class="n">symbol</span><span class="p">])</span>

      <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">integer_molecule</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">long</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/chempleter_logo.png" alt="Logo" />
    
  </a>
</p>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo.html">Chempleter modes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../validation.html">Model history</a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="https://github.com/davistdaniel/chempleter">Github</a></li>
    
    <li class="toctree-l1"><a href="https://pypi.org/project/chempleter/">PyPi</a></li>
    
</ul>

<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2026, Davis Thomas Daniel.
      
      |
      <a href="../_sources/validations/bridge_v1.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>